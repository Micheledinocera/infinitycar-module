<div class="form-container">
  <div class="form-header">
    <h1>Modulo di Registrazione</h1>
    <p>Compila tutti i campi obbligatori per procedere</p>
  </div>

  <form [formGroup]="form" (ngSubmit)="onSubmit()" class="form">
    <!-- Sezione Personale -->
    <section class="form-section">
      <h2>Informazioni Personali</h2>
      <div class="form-row">
        <div class="form-group">
          <label for="firstName">Nome *</label>
          <input
            type="text"
            id="firstName"
            formControlName="firstName"
            class="form-input"
            [class.error]="submitted() && firstName?.invalid"
          />
          @if (submitted() && firstName?.invalid) {
            <span class="error-message">
              @if (firstName?.errors?.['required']) { Nome è obbligatorio }
              @if (firstName?.errors?.['minlength']) { Minimo 2 caratteri }
            </span>
          }
        </div>

        <div class="form-group">
          <label for="lastName">Cognome *</label>
          <input
            type="text"
            id="lastName"
            formControlName="lastName"
            class="form-input"
            [class.error]="submitted() && lastName?.invalid"
          />
          @if (submitted() && lastName?.invalid) {
            <span class="error-message">
              @if (lastName?.errors?.['required']) { Cognome è obbligatorio }
              @if (lastName?.errors?.['minlength']) { Minimo 2 caratteri }
            </span>
          }
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="codFiscale">Codice Fiscale *</label>
          <input
            type="text"
            id="codFiscale"
            formControlName="codFiscale"
            class="form-input"
            placeholder="es. RSSMRA80A01H501T"
            [class.error]="submitted() && codFiscale?.invalid"
          />
          @if (submitted() && codFiscale?.invalid) {
            <span class="error-message">Codice Fiscale non valido</span>
          }
        </div>

        <div class="form-group">
          <label for="phone">Telefono *</label>
          <input
            type="tel"
            id="phone"
            formControlName="phone"
            class="form-input"
            placeholder="es. +39 123 456 7890"
            [class.error]="submitted() && phone?.invalid"
          />
          @if (submitted() && phone?.invalid) {
            <span class="error-message">Telefono non valido</span>
          }
        </div>
      </div>

      <div class="form-row">
        <div class="form-group full-width">
          <label for="email">Email *</label>
          <input
            type="email"
            id="email"
            formControlName="email"
            class="form-input"
            [class.error]="submitted() && email?.invalid"
          />
          @if (submitted() && email?.invalid) {
            <span class="error-message">Email non valida</span>
          }
        </div>
      </div>

      <div class="form-row">
        <div class="form-group full-width">
          <label for="confirmEmail">Conferma Email *</label>
          <input
            type="email"
            id="confirmEmail"
            formControlName="confirmEmail"
            class="form-input"
            [class.error]="submitted() && (confirmEmail?.invalid || form.errors?.['emailMismatch'])"
          />
          @if (submitted() && confirmEmail?.invalid) {
            <span class="error-message">Email di conferma è obbligatoria</span>
          }
          @if (submitted() && form.errors?.['emailMismatch']) {
            <span class="error-message">Le email non coincidono</span>
          }
        </div>
      </div>
    </section>

    <!-- Sezione Indirizzo -->
    <section class="form-section">
      <h2>Indirizzo</h2>
      <div class="form-row">
        <div class="form-group">
          <label for="street">Via/Piazza *</label>
          <input
            type="text"
            id="street"
            formControlName="street"
            class="form-input"
            [class.error]="submitted() && street?.invalid"
          />
          @if (submitted() && street?.invalid) {
            <span class="error-message">Via/Piazza è obbligatoria</span>
          }
        </div>

        <div class="form-group">
          <label for="civico">Civico *</label>
          <input
            type="text"
            id="civico"
            formControlName="civico"
            class="form-input"
            placeholder="es. 10/A"
            [class.error]="submitted() && civico?.invalid"
          />
          @if (submitted() && civico?.invalid) {
            <span class="error-message">Civico è obbligatorio</span>
          }
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="city">Città *</label>
          <input
            type="text"
            id="city"
            formControlName="city"
            class="form-input"
            [class.error]="submitted() && city?.invalid"
          />
          @if (submitted() && city?.invalid) {
            <span class="error-message">Città è obbligatorio</span>
          }
        </div>

        <div class="form-group">
          <label for="zipCode">CAP *</label>
          <input
            type="text"
            id="zipCode"
            formControlName="zipCode"
            class="form-input"
            placeholder="00000"
            [class.error]="submitted() && zipCode?.invalid"
          />
          @if (submitted() && zipCode?.invalid) {
            <span class="error-message">CAP non valido (5 cifre)</span>
          }
        </div>

        <div class="form-group">
          <label for="provincia">Provincia *</label>
          <input
            type="text"
            id="provincia"
            formControlName="provincia"
            class="form-input"
            placeholder="es. RM"
            [class.error]="submitted() && provincia?.invalid"
          />
          @if (submitted() && provincia?.invalid) {
            <span class="error-message">Provincia è obbligatorio</span>
          }
        </div>
      </div>
    </section>

    <!-- Sezione Auto -->
    <section class="form-section">
      <h2>Dati Auto</h2>
      <div class="form-row">
        <div class="form-group">
          <label for="targa">Targa</label>
          <input
            type="text"
            id="targa"
            formControlName="targa"
            class="form-input"
            [class.error]="submitted() && targa?.invalid"
          />
          @if (submitted() && targa?.invalid) {
            <span class="error-message">targa è obbligatoria</span>
          }
        </div>

        <div class="form-group">
          <label for="civico">Civico *</label>
          <input
            type="text"
            id="civico"
            formControlName="civico"
            class="form-input"
            placeholder="es. 10/A"
            [class.error]="submitted() && civico?.invalid"
          />
          @if (submitted() && civico?.invalid) {
            <span class="error-message">Civico è obbligatorio</span>
          }
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="city">Città *</label>
          <input
            type="text"
            id="city"
            formControlName="city"
            class="form-input"
            [class.error]="submitted() && city?.invalid"
          />
          @if (submitted() && city?.invalid) {
            <span class="error-message">Città è obbligatorio</span>
          }
        </div>

        <div class="form-group">
          <label for="zipCode">CAP *</label>
          <input
            type="text"
            id="zipCode"
            formControlName="zipCode"
            class="form-input"
            placeholder="00000"
            [class.error]="submitted() && zipCode?.invalid"
          />
          @if (submitted() && zipCode?.invalid) {
            <span class="error-message">CAP non valido (5 cifre)</span>
          }
        </div>

        <div class="form-group">
          <label for="provincia">Provincia *</label>
          <input
            type="text"
            id="provincia"
            formControlName="provincia"
            class="form-input"
            placeholder="es. RM"
            [class.error]="submitted() && provincia?.invalid"
          />
          @if (submitted() && provincia?.invalid) {
            <span class="error-message">Provincia è obbligatorio</span>
          }
        </div>
      </div>
    </section>

    <!-- Sezione Privacy -->
    <section class="form-section">
      <h2>Privacy e Consensi</h2>
      
      <div class="form-checkbox">
        <input
          type="checkbox"
          id="privacyConsent"
          formControlName="privacyConsent"
          [class.error]="submitted() && privacyConsent?.invalid"
        />
        <label for="privacyConsent">
          Accetto l'informativa sulla privacy e il trattamento dei dati personali *
        </label>
      </div>
      @if (submitted() && privacyConsent?.invalid) {
        <span class="error-message block">Devi accettare l'informativa sulla privacy</span>
      }

      <div class="form-checkbox">
        <input
          type="checkbox"
          id="marketingConsent"
          formControlName="marketingConsent"
        />
        <label for="marketingConsent">
          Accetto di ricevere comunicazioni di marketing e promozioni
        </label>
      </div>
    </section>

    <!-- Pulsanti -->
    <div class="form-actions">
      <button
        type="submit"
        class="btn btn-primary"
        [disabled]="isFormInvalid()"
      >
        Invia
      </button>
      <button
        type="button"
        class="btn btn-secondary"
        (click)="reset()"
      >
        Ripristina
      </button>
    </div>
  </form>
</div>
